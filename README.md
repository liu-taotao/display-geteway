[TOC]

## å°è¯•æ­å»ºä¸€ä¸ªåŸºäºå·¥æ§æ¿çš„æœåŠ¡å™¨

> æ³¨: **è¿™é‡Œä»…å±•ç¤º** 

æœ€ç»ˆæ•ˆæœ
-------------

![video-to-gif](./img/video-to-gif.gif)



--------------------

### 01ã€å‡†å¤‡å·¥ä½œ

**â‘ mqttåˆä½“éªŒ**

â€‹    1ã€å®¢æˆ·ç«¯ç•Œé¢ ä½¿ç”¨ **mqttfx1.7.1** `å› ä¸ºå…¶ä»–ç‰ˆæœ¬éœ€è¦license` 

â€‹	2ã€æœåŠ¡å™¨ä½¿ç”¨å…¬ç”¨æœåŠ¡å™¨ **ç„¶ä¹Ÿç‰©è”** 

> MQTT æœåŠ¡å™¨åœ°å€ï¼š test.ranye-iot.net
> TCP ç«¯å£ï¼š 1883
>    TCP/TLS ç«¯å£ï¼š 8883  

**â‘¡æ­¤æ—¶éœ€è¦`ç”¨æˆ·å` `å¯†ç ` `å®¢æˆ·ç«¯ID`**
`ç”±äºä¸ªäººä¸æƒ³ç”³è¯·ä¸ªäººå¹³å° é‚£æˆ‘å°±ç”¨å…¬å…±çš„`

> ç”¨æˆ·å:    test-user
> å¯†ç :      ranye-iot
> å®¢æˆ·ç«¯ID:  ğŸ˜’
TODO
**â‘¢æŸ¥çœ‹éœ€è¦ä¸»é¢˜**

### 02ã€å¿…å‘æŒ‡å—

**â‘ å¼€å‘æ¿å¯åŠ¨sshæœåŠ¡ä¼ è¾“æ–‡ä»¶** `ä¸ºä»€ä¹ˆï¼Ÿ` **å› ä¸ºä½¿ç”¨filezillaä¼ æ–‡ä»¶ä¼šä½¿æ–‡ä»¶æŸåï¼Ÿï¼Ÿ** **ä»€ä¹ˆpoå·¥æ§æ¿**

> æ‰€ä»¥åªèƒ½ä½¿ç”¨ **scp** å‘½ä»¤äº† 
>
> å½“ç„¶è¿™é‡Œä¹Ÿæ˜¯ç”¨**putty**è¿æ¥å¼€å‘æ¿

### 03ã€ç›®å‰å‰é¢å·²å®Œæˆ ä¸»è¦å°±æ˜¯mqttåº“ç§»æ¤åˆ°arm9å¼€å‘æ¿ å½“ç„¶è¿™ä¸ªå¦‚ä½•ç§»æ¤å‘¢ï¼Ÿ(è¿˜åœ¨æ‰¾æ–¹æ³•å‘¢)

**â‘ çŸ¥é“å¦‚ä½•ç§»æ¤ ä½†æ˜¯cmakeæ–‡ä»¶ä¸çŸ¥é“å¦‚ä½•ä¿®æ”¹**  ã€è®°å½• ä»Šå¤©æ˜¯2023.11.21ã€‘
TODO



### 04ã€é‡æ„äº†å“¦(é¦–å…ˆå®ç°çš„æ˜¯Ubuntuå’Œpcæœºç«¯)ğŸ˜

**â‘ pcç«¯å¼€å¯mqttæœåŠ¡**

> â‘ é¦–å…ˆè¦çŸ¥é“å®‰è£…ä¾èµ–mqttä¾èµ–opensslå¦åˆ™ç¼–è¯‘ `mqtt`åº“æ—¶ä¼šæŠ¥é”™ã€‚å…·ä½“[å®‰è£…openssl](https://blog.csdn.net/wu10188/article/details/124970453) ç„¶åç¼–è¯‘ **`paho.mqtt.c`** å…·ä½“ç¼–è¯‘è·¯å¾„ï¼Œä»¥åŠå¦‚ä½•å®‰è£…mqttåº“ï¼Œ[è¯·ç‚¹å‡»](https://blog.csdn.net/thisway_diy/article/details/125557534) ã€‚

**â‘¡æœ€åæ‰€å¾—åˆ°ç»“æœæ˜¯è¿™æ ·çš„**

**`ç¬¬ä¸€å¼ `** Ubuntuä¸‹ å®¢æˆ·ç«¯

![å®¢æˆ·ç«¯ç«¯](./img/pcç«¯.png)

**`ç¬¬äºŒå¼ `** æœåŠ¡å™¨ç«¯

![æœåŠ¡å™¨ç«¯](./img/æœåŠ¡å™¨ç«¯.png)

### 05ã€ç§»æ¤mqttåº“åˆ°å¼€å‘æ¿åº“

**â‘ åŒæ—¶è¦æ³¨æ„ç¼–è¯‘äº¤å‰ç¼–è¯‘åçš„opensslåº“ [è¯·ç‚¹å‡»](https://blog.csdn.net/m0_49857167/article/details/128381931)**

> 1ã€æ³¨æ„äº¤å‰ç¼–è¯‘å·¥å…·éœ€è¦ç§»æ¤çš„`openssl`ä¸ç„¶ä¼šæŠ¥é”™ **æ‰¾ä¸åˆ°åº“æ–‡ä»¶ æ‰€æœ‰`arm-linux-gcc`ç¼–è¯‘çš„æ–‡ä»¶éƒ½ä¼šç¼ºå°‘æ–‡ä»¶åº“**
>
> 2ã€ç¼–è¯‘å¥½ä»¥åå°†å½“å‰`build/output/`ä¸‹çš„æ‰€æœ‰åº“æ”¾åˆ°å¼€å‘æ¿`/usr/lib/`ä¸­

**â‘¡ç»ˆç»“å¤§é—®é¢˜**

**ç‰¹åˆ«æ˜¯ç¼–è¯‘mqttåº“æ—¶ä¸€æ¬¡ç¼–è¯‘å°±å¤Ÿäº†ï¼Œé‡å¤ç¼–è¯‘éœ€è¦åˆ é™¤`.so`è¿™ç§æ–‡ä»¶æ‰èƒ½ç¼–è¯‘æˆåŠŸ**

### 	06ã€`mouse`æ€»ç»“ç§»æ¤å†…å®¹ğŸ˜­

 **å®Œå…¨å—ä¸äº†** `å®åœ¨æ˜¯å¤ªç—›è‹¦äº†`

**â‘ ã€ã€ç¡¬æ ¸å†…å®¹ã€‘`mqttåº“`ç§»æ¤å¼€å‘æ¿æ€»ç»“**

> â‘ é¦–å…ˆåœ¨Ubuntuä¸­ç§»æ¤`MQTT`åº“
>
> * é¦–å…ˆä¸‹è½½**MQTT**åº“
>
>   ```C
>   git clone https://github.com/eclipse/paho.mqtt.c.git
>   ```
>
> * ç„¶ååœ¨ä¸‹è½½å¥½çš„è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­`./paho.mqtt.c`è¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨**Ubuntuä¸­**ä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªé¡¶å±‚`Makefile`é™¤éä½ çš„è·¯å¾„æœ‰å˜åŒ–ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚
>
>   ```C
>   make
>   sudo make install
>   ```
>
>   è¿™æ¡æŒ‡ä»¤ä¼šå°†**mqttç¨‹åº**ä¾èµ–çš„åº“æ–‡ä»¶å®‰è£…åˆ°`/usr/local`ä¸‹çš„`bin`ã€`lib`ã€`include`å’Œ`share`ä¸‹ï¼ŒåŒæ—¶ç¼–è¯‘å‡ºæ¥çš„åº“åœ¨`./paho.mqtt.c/build/output`ä¸­ã€‚
>
> * é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¼€å§‹å¼€å‘äº†ï¼Œå°†`paho.mqtt.c`ä¸‹çš„srcå’Œsampleé‡Œé¢çš„éšæ„ä¸€ä¸ªç¤ºä¾‹ä»£ç copyè¿‡æ¥,è¿™é‡Œæˆ‘æ˜¯`MQTTAsync_subscribe.c`ï¼Œä½†æ˜¯æ˜¯éœ€è¦ä¿®æ”¹çš„ï¼Œå› ä¸ºå¤´æ–‡ä»¶è·¯å¾„å˜äº†ã€‚é¦–å…ˆæ˜¯å¤´æ–‡ä»¶`MQTTAsync.h`ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šè·¯å¾„ï¼Œä¸ç„¶åœ¨å½“å‰ç›®å½•ä¸‹æ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªå¤´æ–‡ä»¶çš„ï¼Œæˆ‘ä»¬å·²ç»å°†è¿™ä¸ªå¤´æ–‡ä»¶æ‰€åœ¨çš„å®˜æ–¹æºæ–‡ä»¶æ–‡ä»¶å¤¹`src`copyè¿‡æ¥äº†ï¼Œæ‰€ä»¥åªéœ€è¦æ”¹æˆï¼š
>
>   ```C
>   #include "src/MQTTAsync.h"
>   ```
>   * åŒæ—¶éœ€è¦ä¿®æ”¹ç½‘å…³`URL`å’Œ`CLIENTID`ä»¥åŠè®¢é˜…çš„`TOPIC`ï¼Œè¿˜è¦æ·»åŠ è”ç½‘å¹³å°è®¾å¤‡çš„ç”¨æˆ·å`USERNAME`å’Œå¯†ç `PASSWORD`, å¹³å°å¯é€‰**é˜¿é‡Œã€ç™¾åº¦ã€ç­‰**ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©**ç„¶ä¹Ÿç‰©è”**ï¼Œä»¥ä¸‹æ—¶åŸæ¥çš„å‚æ•°/éœ€ä¿®æ”¹ã€‚
>
>   ```C
>    32 #define ADDRESS     "tcp://mqtt.eclipseprojects.io:1883"
>    33 #define CLIENTID    "ExampleClientSub"
>    34 #define TOPIC       "MQTT Examples"
>   ```
>
>   * åŒæ—¶é‰´äºç„¶ä¹Ÿç‰©è”å¹³å°çš„è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿æ¥æ§åˆ¶åŒ…çš„`keepAliveInterval`è®¾ç½®ä½**60**ï¼Œå¹¶ä¸”å¯¹æ§åˆ¶åŒ…çš„ç”¨æˆ·å`username`å’Œå¯†ç `password`èµ‹å€¼ä¸ºæˆ‘ä»¬å®å®šä¹‰çš„å€¼
>
>     ```C
>     /* void connlost(void *context, char *cause) */ 
>     conn_opts.username = USERNAME;
>     conn_opts.password = PASSWORD;
>     conn_opts.keepAliveInterval = 60;
>     
>     /* int main(int argc, char* argv[]) */
>     conn_opts.username = USERNAME;
>     conn_opts.password = PASSWORD;
>     conn_opts.keepAliveInterval = 60;
>     ```
>
>   * ç¼–è¯‘ä¿®æ”¹å·ä¹‹åçš„`MQTTAsync_subscribe.c`ï¼š
>
>     ```C
>     # gcc MQTTAsync_subscribe.c -lpaho-mqtt3a
>     # ./a.out
>     ```
>
> â‘  ç§»æ¤`MQTT`åˆ°å¼€å‘æ¿
>
> * åŒç†ï¼Œéœ€è¦ä¿®æ”¹é¡¶å±‚**Makefile** åªéœ€ä¿®æ”¹**ç¼–è¯‘å™¨é€‰é¡¹** å’Œ ä¾èµ–åº“æ”¾åˆ°**äº¤å‰ç¼–è¯‘å™¨**åº“æ–‡ä»¶`/usr/local`ä¸‹çš„`bin`ã€`lib`ã€`include`å’Œ`share`ä¸‹ã€‚æˆ‘çš„æ˜¯->
>
>   * è¿™æ˜¯è®¾ç½®prefixï¼Œåˆ°ç¼–è¯‘å™¨è·¯å¾„ä¸‹**å°†è¿™äº›è·¯é“¾æ¥åˆ°äº¤å‰ç¼–è¯‘å™¨**
>
>   ![profix](./img/profix.png)
>
>   * è¿™æ˜¯è®¾ç½®ç¼–è¯‘å™¨
>
>   ![cc](./img/cc.png)
>
> * åœ¨ç¼–è¯‘è¿™ä¸ªåˆ°armæ¿çš„`MQTT`åº“ä¹‹å‰éœ€è¦å®‰è£…**opensslåº“**è¿™ä¸ªå¼‚å¸¸é‡è¦ï¼Œä¹Ÿéœ€è¦ **`äº¤å‰ç¼–è¯‘è¿™ä¸ªåº“`** å¹¶ä¸”è¿˜éœ€è¦æŠŠç¼–è¯‘åçš„`bin`ã€`lib`ã€`include`å’Œ`share`ï¼Œç§»æ¤åˆ°**ä¸Šå›¾äº¤å‰ç¼–è¯‘å™¨çš„**`bin`ã€`lib`ã€`include`å’Œ`share`ç­‰å…¨éƒ¨éƒ½è¦ç§»æ¤ï¼Œå‚è€ƒæ–‡æ¡£ **`chatGPT`** è¾“å‡ºæ–‡æ¡£ã€‚->
>
>   > åœ¨ Ubuntu ä¸‹ä¸ºäº¤å‰ç¼–è¯‘å™¨å®‰è£… OpenSSLï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š
>   >
>   > 1. ç¡®å®š OpenSSL çš„ç‰ˆæœ¬ï¼šé¦–å…ˆç¡®å®šæ‚¨å¸Œæœ›å®‰è£…çš„ OpenSSL ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä»æºä»£ç ç¼–è¯‘å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œæˆ–è€…ä½¿ç”¨é€‚ç”¨äºæ‚¨çš„äº¤å‰ç¼–è¯‘å™¨çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
>   >
>   > 2. ä¸‹è½½ OpenSSL æºä»£ç ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœæ‚¨é€‰æ‹©ä»æºä»£ç ç¼–è¯‘å®‰è£… OpenSSLï¼Œè¯·å‰å¾€ OpenSSL çš„å®˜æ–¹ç½‘ç«™ï¼ˆhttps://www.openssl.org/ï¼‰ä¸‹è½½æºä»£ç åŒ…ï¼ˆtar.gz æ ¼å¼ï¼‰ã€‚ã€æ­¤æºç æˆ‘æ˜¯ä¸‹è½½å‰é¢å®‰è£…**opensslæ–‡ç« ** æä¾›çš„ã€‚ã€‘
>   >
>   > 3. è§£å‹æºä»£ç åŒ…ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ï¼šå¦‚æœæ‚¨ä¸‹è½½äº†æºä»£ç åŒ…ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£å‹å®ƒï¼š
>   >    ````
>   >    tar -xzf openssl-x.x.x.tar.gz
>   >    ```
>   >    å…¶ä¸­ `openssl-x.x.x.tar.gz` æ˜¯æ‚¨ä¸‹è½½çš„æºä»£ç åŒ…çš„æ–‡ä»¶åã€‚
>   >
>   > 4. è¿›å…¥ OpenSSL æºä»£ç ç›®å½•ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥è§£å‹åçš„ OpenSSL æºä»£ç ç›®å½•ï¼š
>   >    ````
>   >    cd openssl-x.x.x
>   >    ```
>   >    å…¶ä¸­ `openssl-x.x.x` æ˜¯è§£å‹åçš„æºä»£ç ç›®å½•åã€‚
>   >
>   > 5. é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒå˜é‡ï¼šæ ¹æ®æ‚¨çš„äº¤å‰ç¼–è¯‘å™¨è·¯å¾„å’Œç›®æ ‡æ¶æ„ï¼Œè®¾ç½®é€‚å½“çš„äº¤å‰ç¼–è¯‘ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„äº¤å‰ç¼–è¯‘å™¨è·¯å¾„ä¸º `/usr/local/arm/usr/local/arm/4.8.3/bin/arm-none-linux-gnueabi-gcc`ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é…ç½®ç¯å¢ƒå˜é‡ï¼š
>   >    ````
>   >    export CC=/usr/local/arm/usr/local/arm/4.8.3/bin/arm-none-linux-gnueabi-gcc
>   >    export AR=/usr/local/arm/usr/local/arm/4.8.3/bin/arm-none-linux-gnueabi-ar
>   >    export RANLIB=/usr/local/arm/usr/local/arm/4.8.3/bin/arm-none-linux-gnueabi-ranlib
>   >    ```
>   >    ç¡®ä¿å°†è·¯å¾„æ›¿æ¢ä¸ºæ‚¨å®é™…çš„äº¤å‰ç¼–è¯‘å™¨è·¯å¾„ã€‚
>   >
>   > 6. é…ç½® OpenSSL ç¼–è¯‘é€‰é¡¹ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤é…ç½® OpenSSL çš„ç¼–è¯‘é€‰é¡¹ï¼š
>   >    ````
>   >    ./Configure --prefix=/usr/local/openssl -static <target>
>   >    ```
>   >    å…¶ä¸­ `<target>` æ˜¯æ‚¨çš„ç›®æ ‡æ¶æ„ï¼Œä¾‹å¦‚ `linux-armv4` æˆ– `linux-armv7`ã€‚ç‰¹åˆ«è¯´æ˜**è¿™é‡Œç”±äºæˆ‘æ˜¯arm9ä½œç”¨æˆ‘é€‰æ‹©v4æ¶æ„**ã€‚
>   >
>   > 7. ç¼–è¯‘å’Œå®‰è£… OpenSSLï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å’Œå®‰è£… OpenSSLï¼š
>   >    ````
>   >    make
>   >    sudo make install
>   >    ```
>   >
>   > 8. å®Œæˆå®‰è£…ï¼šå®‰è£…å®Œæˆåï¼Œæ‚¨å°†åœ¨ `/usr/local/openssl` ç›®å½•ä¸‹æ‰¾åˆ°äº¤å‰ç¼–è¯‘åçš„ OpenSSL åº“å’Œå¤´æ–‡ä»¶ã€‚
>   >
>   > è¯·æ³¨æ„ï¼Œä¸Šè¿°æ­¥éª¤æä¾›äº†åŸºæœ¬çš„è¿‡ç¨‹ï¼Œå…·ä½“æ­¥éª¤å¯èƒ½ä¼šæ ¹æ®æ‚¨çš„ç³»ç»Ÿå’Œç¼–è¯‘ç¯å¢ƒæœ‰æ‰€ä¸åŒã€‚ç¡®ä¿æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œå¹¶å‚è€ƒ OpenSSL çš„æ–‡æ¡£å’Œè¯´æ˜æ¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
>
> * åˆ°æ­¤å†å»ç¼–è¯‘`paho.mqtt.c`æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶
>
>   ```C
>   make
>   sudo make install
>   ```
>
>   å°±å¯ä»¥å°†`./build/output`ä¸‹çš„**.so** ç­‰æ–‡ä»¶æ‰“åŒ…ç§»æ¤åˆ°å¼€å‘æ¿`/usr/lib`ä¸‹å°±å¯ä»¥äº†

**â‘¡ã€å¤§å‘æŒ‡å—ã€‘**

> ç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨`make` `sudo make install`æ—¶å€™å‡ºç°ä»€ä¹ˆ`.so `å·²å­˜åœ¨ è¿™å°±éœ€è¦å»ç¼–è¯‘ç›®å½•ä¸‹å°†æ‰€æœ‰çš„ç¼–è¯‘æ–‡ä»¶åˆ é™¤ï¼Œæˆ‘è¿™é‡Œæ˜¯`/usr/local/arm/usr/local/arm/4.8.3/arm-none-linux-gnubihf/lib`ä¸‹å»åˆ é™¤æ‰€æœ‰çš„**.so**æ–‡ä»¶ï¼Œã€è®°ä½æ˜¯æ‰€æœ‰ã€‘ã€‚ç„¶åå†å»å†æ¬¡ç¼–è¯‘ï¼Œæ‰ä¸ä¼šå‡ºç°ä»€ä¹ˆæ–‡ä»¶**........so** æ–‡ä»¶å·²å­˜åœ¨ã€‚

TODO

ã€2023.11.23ã€‘

### 07ã€ç¼–ç¨‹æ–¹é¢ Big_Brainy

* [è¿™æ˜¯æºç ï¼Œè¯·ç‚¹å‡»](./src/index.c)

* â‘ è§£é‡Š`MQTT` ç¼–ç¨‹çš„åŸºæœ¬å‡½æ•°åŒºåˆ« = ï¼šã€è¯´æ˜ è¿™é‡Œç”¨çš„æ˜¯**åŒæ­¥æœºåˆ¶** çš„`mqttclient` ã€‘**è®°å¾—å›è°ƒå‡½æ•° åœ¨è¿æ¥æœåŠ¡å™¨å‡½æ•°ä¹‹å‰ä½¿ç”¨** 

  ```C
  /*  paho mqttåŸºæœ¬æ“ä½œ
      æˆ‘ä»¬ä½¿ç”¨mqttæœ‰å¦‚ä¸‹å‡ ä¸ªæ“ä½œï¼š
  
      åˆ›å»º/é”€æ¯å®¢æˆ·ç«¯
      è¿æ¥/æ–­å¼€è¿æ¥æœåŠ¡å™¨
      è®¢é˜…/å–æ¶ˆè®¢é˜…ä¸»é¢˜
      å¤„ç†è®¢é˜…æ¶ˆæ¯
      å‘å¸ƒä¸»é¢˜æ¶ˆæ¯*/
  	
  //1ã€å®¢æˆ·ç«¯å¥æŸ„ï¼šMQTTClient
  // MQTTClient.h
  typedef void* MQTTClient;
  
  // .cæ–‡ä»¶ä¸­å®šä¹‰å®¢æˆ·ç«¯å¥æŸ„
  MQTTClient client;
  
  //2ã€åˆ›å»ºå®¢æˆ·ç«¯å‡½æ•°  å¦‚æœæˆåŠŸè¿”å›MQTTCLIENT_SUCCESS å¦åˆ™è¿”å›é”™è¯¯ç 
  int MQTTClient_create(MQTTClient* handle, 
                        const char* serverURI, 
                        const char* clientId,
                        int persistence_type, 
                        void* persistence_context)
  
  //3ã€é”€æ¯åŒæ­¥å®¢æˆ·ç«¯
  void MQTTClient_destroy(MQTTClient* handle)
  
  MQTTClient client;
  MQTTClient_destroy(&client);
  
  //4ã€å›è°ƒå‡½æ•°è®¾ç½®
  int MQTTClient_setCallbacks(MQTTClient handle, 
                              void* context, 
                              MQTTClient_connectionLost* cl,
                              MQTTClient_messageArrived* ma, 
                              MQTTClient_deliveryComplete* dc)
  //5ã€å’ŒæœåŠ¡å™¨è¿æ¥
  LIBMQTT_API int MQTTClient_connect(MQTTClient handle, MQTTClient_connectOptions* options);
  //6ã€å’ŒæœåŠ¡å™¨æ–­å¼€è¿æ¥
  LIBMQTT_API int MQTTClient_disconnect(MQTTClient handle, int timeout);
  
  
  //7ã€è®¢é˜…ä¸»é¢˜
  LIBMQTT_API int MQTTClient_subscribe(MQTTClient handle, const char* topic, int qos);
  
  //8ã€å‘å¸ƒæ¶ˆæ¯
  LIBMQTT_API int MQTTClient_publishMessage(MQTTClient handle, const char* topicName, 
                                            MQTTClient_message* msg,
                                            MQTTClient_deliveryToken* dt);
  
  ```

* å…¶å®åˆ°è¿™é‡Œè¯»å–`RS485æ€»çº¿`çš„æ•°æ® ä½¿ç”¨è¿™ä¸ª**æ¨¡å—åŒ–ç¨‹åº**  ï¼Œ[è¯·ç‚¹å‡»ï¼Œæºç å¦‚ä¸‹](./src/tty.c)

### 08ã€å‘å¸ƒæ¶ˆæ¯æ§åˆ¶å¯¹åº”çš„æ§åˆ¶å‘½ä»¤

| å‘½ä»¤ |       å¯¹åº”çš„æ§åˆ¶å¯¹è±¡       |
| :--: | :------------------------: |
| down |            å…³ç¯            |
|  on  |            å¼€ç¯            |
| buz  | èœ‚é¸£å™¨å¼€(å¼€2såå…³ï¼Œå¤ªåµäº†) |

### 09ã€å°è£…å’Œæ¨¡å—åŒ–COMå£å‘é€å’Œè¯»å–æ¨¡å—

> æ³¨: è¿™é‡Œä¿®æ”¹å¾ˆå¤šçš„å‚æ•°-> åŒ…æ‹¬ä½†ä¸é™äºæ³¢ç‰¹ç‡ åœæ­¢ä½ æ•°æ®ä½ç­‰ å…¨éƒ¨éƒ½å†™æˆäº†ç»Ÿä¸€çš„å‚æ•° å®Œå…¨å°è£…ã€‚ã€2023.11.25ã€‘TODO

* å°è£…åçš„**æºç  ** [è¯·ç‚¹å‡»ï¼Œæºç å¦‚ä¸‹](./src/soc.c)

### 10ã€RS485å’Œmodbusåè®® é€šä¿¡çš„ä»æœºè®¾å¤‡

**ã€é€šè¿‡pcä¸»æœº æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ä»æœºã€‘** -> 2023.11.26

* â‘ ä¸»è¦æ˜¯**ä¸»æœº** `è¯¢é—®` **ä»æœº** `åº”ç­”`æ–¹å¼ ã€å·²ç»èƒ½æˆåŠŸæ¥æ”¶äº†ã€‘åŒæ—¶å‘ç°äº†ä¸€ä¸ª[CRCæ ¡éªŒç½‘ç«™](http://www.ip33.com/crc.html) åªéœ€å°†modbuså‘é€æ•°æ®å‰6ä¸ªè¾“å…¥ å°±ä¼šè‡ªåŠ¨ç”Ÿæˆ`CRCæ ¡éªŒä½` æ³¨æ„è¿™é‡Œä½¿ç”¨æ—¶ è¿™**ä¸¤ä½è¦äº¤æ¢** ã€‚

  ![æ•°æ®](./img/æ•°æ®.png)

* åœ¨æ­¤`é‡è§`ä¸€ä¸ªé—®é¢˜ **å°±æ˜¯ä¸ºä»€ä¹ˆå°†å…¶åº”ç”¨åˆ°Linuxå¼€å‘æ¿å°±ä¸å¯ä»¥æ¥æ”¶æ•°æ®äº†** ã€è¡¨ç¤ºç–‘æƒ‘ã€‘åŒç†`æœ‰çš„ä¸²å£è°ƒè¯•åŠ©æ‰‹å¯ä»¥æ¥æ”¶åˆ°æ•°æ® æœ‰çš„ä¸å¯ä»¥` ğŸ¤”ğŸ¤”ğŸ¤”

  > **çŒœæƒ³ï¼š ** æ²¡æœ‰æ­£ç¡®ä¾›ç”µï¼ŸğŸ¤”
  >
  > **å™¨ä»¶: ** è¿™é‡Œæœ‰ç”¨åˆ°äº†**â‘ åŸºäºrs485çš„æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨**   **â‘¡USBè½¬RS485è½¬æ¢å™¨**   **â‘¢ä¸€ä¸ªå·¥ä¸šarmæ¿**
  >
  > **æŒ–ä¸ªå‘ï¼š** å¦‚æœä½ ä¹Ÿæœ‰`ç¢°åˆ° ` ç¥ä½ **å¥½è¿** 

  <img src="./img/å®ç‰©å›¾.jpg" alt="å®ç‰©å›¾"  />

* å¼€å‘æ¿å¯ä»¥`è¯»å–æ•°æ®`äº†

  ![è¯»å–æ•°æ®](./img/è¯»å–æ•°æ®.png)

* é‡è¦çš„`æ—¶åˆ»`åˆ°äº†ï¼Œ**æ•°æ®è§£æ** 

  **å‘é€æ•°æ®** 

  | åœ°å€ | åŠŸèƒ½ç  | èµ·å§‹å¯„å­˜ å™¨åœ°å€é«˜ | èµ·å§‹å¯„å­˜ å™¨åœ°å€ä½ | å¯„å­˜å™¨ é•¿åº¦é«˜ | å¯„å­˜å™¨ é•¿åº¦ä½ | CRC16 ä½ | CRC16 é«˜ |
  | :--: | :----: | :---------------: | :---------------: | :-----------: | :-----------: | :------: | :------: |
  | 0X01 |  0X03  |       0X00        |       0X00        |     0X00      |     0X02      |   0XC4   |   0X0B   |

  **æ¥æ”¶åˆ°çš„æ•°æ®è§£æ** 

  | åœ°å€ç  | åŠŸèƒ½ç  | è¿”å›æœ‰æ•ˆ å­—èŠ‚æ•° |  æ¹¿åº¦å€¼   |  æ¸©åº¦å€¼   | æ ¡éªŒç  ä½ä½ | æ ¡éªŒç  é«˜ä½ |
  | :----: | :----: | :-------------: | :-------: | :-------: | :---------: | :---------: |
  |  0x01  |  0x03  |      0x04       | 0x01 0xE6 | 0x01 0x09 |    0x1B     |    0xA0     |

  **è§£æå…¬å¼** 

  >æ¸©åº¦è®¡ç®—ï¼š
  >å½“æ¸©åº¦ä½äº 0 â„ƒ æ—¶æ¸©åº¦æ•°æ®ä»¥è¡¥ç çš„å½¢å¼ä¸Šä¼ ã€‚
  >æ¸©åº¦ï¼š 0109 H(åå…­è¿›åˆ¶)= 25 => æ¸©åº¦ = 25â„ƒ
  >æ¹¿åº¦è®¡ç®—ï¼š
  >æ¹¿åº¦ï¼š 1E6 H (åå…­è¿›åˆ¶)= 486 => æ¹¿åº¦ = 48.6%RH  

* [å±•ç¤ºæˆ‘å°è£…å¥½çš„è¯»å–comåº“çš„å‡½æ•°](./src/ans.c) ã€2023.11.26ã€‘TODO

  > æ³¨: è¿™æ˜¯æˆ‘å°è£…å¥½çš„å¥½çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå°±ä¸ç”¨å»è®¾ç½®éº»çƒ¦çš„ä¸€å¥— RS485çš„é…ç½®ï¼Œæˆ‘å…¨éƒ¨å†™å¥½äº†é€‚ç”¨äºè¿™ä¸ªä¼ æ„Ÿå™¨çš„æ³¢ç‰¹ç‡ç­‰ï¼Œè‹¥éœ€è¦é…ç½®ä¸åŒä¸åŒçš„ä¼ æ„Ÿå™¨ï¼Œå¯ä»¥ååºä¿®æ”¹ã€‚æˆ‘è¿™é‡Œâ˜æ–¹ä¾¿æˆ‘ç¼–ç¨‹ã€‚

![æ€»ç»“å®ç‰©å›¾](./img/æ€»ç»“å®ç‰©å›¾.jpg)

* æŒ¯åŠ¨`ä¼ æ„Ÿå™¨`éƒ¨åˆ†ã€2023.12.1ã€‘TODO

  > æ³¨: è¿™é‡Œä¸åŒäºæ¸©åº¦ä¼ æ„Ÿå™¨ï¼ŒæŒ¯åŠ¨ä¼ æ„Ÿå™¨ä¼ å›æ¥çš„æ•°æ®å¤šäº†**Xã€Yã€Z** è½´è¿™å‡ ä¸ªæ•°æ®ï¼ŒåæœŸéœ€è¦è¿›è¡Œ  **FFTå˜æ¢** å¾—åˆ°é¢‘è°±åˆ†æ

	| åœ°å€ | åŠŸèƒ½ç  | èµ·å§‹å¯„å­˜ å™¨åœ°å€é«˜ | èµ·å§‹å¯„å­˜ å™¨åœ°å€ä½ | å¯„å­˜å™¨ é•¿åº¦é«˜ | å¯„å­˜å™¨ é•¿åº¦ä½ | CRC16 ä½ | CRC16 é«˜ |
	| :--: | :----: | :---------------: | :---------------: | :-----------: | :-----------: | :------: | :------: |
	| 0X01 |  0X03  |       0X00        |       0X00        |     0X00      |     0X04      |   0X44   |   0X09   |

	**æ¥æ”¶åˆ°çš„æ•°æ®è§£æ** 

	| åœ°å€ç  | åŠŸèƒ½ç  | æ•°æ®é•¿åº¦ |  æ¸©åº¦å€¼   |   Xè½´å€¼   | Yè½´å€¼     | Zè½´å€¼     | æ ¡éªŒç  ä½ä½ | æ ¡éªŒç  é«˜ä½ |
	| :----: | :----: | :------: | :-------: | :-------: | --------- | --------- | :---------: | :---------: |
	|  0x01  |  0x03  |   0x08   | 0x00 0x1A | 0x00 0x02 | 0x00 0x03 | 0x00 0x04 |    0xA6     |    0x15     |
	
	**è¿™é‡Œç”±äºè¦è¿›è¡Œfftå˜æ¢æ‰€ä»¥åŠ å…¥äº†mathåº“** `ç¼–è¯‘è¿‡ç¨‹å˜äº†` 
	
	```C
	arm-linux-gcc file.c -lpaho-mqtt3c -lm
	```

* FFTå˜æ¢éƒ¨åˆ†

  > æ³¨: è¿™é‡Œæ·»åŠ äº†fftéƒ¨åˆ†çš„ï¼Œéƒ¨åˆ†æ¼”ç¤º, **è¶å½¢è¿ç®—** 

  ![fftéƒ¨åˆ†æ¼”ç¤º](./img/fftéƒ¨åˆ†æ¼”ç¤º.png)

  * è¿™é‡Œæœ‰é€šè¿‡mqttä¸Šä¼ æ•°æ®åˆ°å®¢æˆ·ç«¯å®ç°æ•°æ®ç›‘æ§ã€‚ä»¥ä¸‹æ˜¯æ•ˆæœã€**æˆ‘æœªè¿æ¥å¼€å‘æ¿ï¼Œå› ä¸ºå±•ç¤ºæ²¡æœ‰ä»¥å¤ªç½‘**ã€‘TODO

    è¿™é‡Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯åœ¨`Ubuntuä¸‹`æµ‹è¯•çš„ï¼ŒåŒæ—¶`å¼€å‘æ¿`ä¸Šä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æœ‰äº†æ•°æ®çš„è¯»å–ã€‚

    ![ä¸‰ç»„æ•°æ®](./img/ä¸‰ç»„æ•°æ®.png)

    ![ä¼ è¾“çš„æ¸©åº¦æ•°æ®](./img/ä¼ è¾“çš„æ¸©åº¦æ•°æ®.png)



### 11ã€ä¸²å£å±æ˜¾ç¤ºéƒ¨åˆ†

> è¿™é‡Œä½¿ç”¨äº†ä¸²å£å±æ˜¾ç¤ºã€‚ä¹Ÿå°±æ˜¯ä½¿ç”¨RS485->TTLè¿™æ ·çš„ä¸€ä¸ªè½¬æ¢ã€‚TODOã€è€ƒå®Œè¯•å2023.12.1ã€‘ç”±äºrs232->æ¨¡å—è¿˜æ²¡åˆ°ï¼Œæ‰€ä»¥æš‚æ—¶æ— æ³•ä½¿ç”¨è¿™ä¸ªä¸²å£å±è¿›è¡Œæœ¬åœ°æ˜¾ç¤ºã€‚







### 12ã€å±•ç¤ºæˆæœçš„æ—¶åˆ»åˆ°äº†-> ğŸ˜ğŸ˜

> æ¥æ”¶**COMå£** å‡½æ•°è®¾è®¡

**â‘ æ¥æ”¶COMå£æ•°æ®æµ‹è¯•** 

![pcæœºæˆæœ](./img/pcæœºæˆæœ.png)

**â‘¡æœåŠ¡å™¨ç«¯å‘é€æ•°æ® å®¢æˆ·ç«¯è®¢é˜…æ¶ˆæ¯å›è°ƒå‡½æ•°æ‰§è¡Œ** 

![è®¢é˜…å›è°ƒå‡½æ•°](./img/è®¢é˜…å›è°ƒå‡½æ•°.png)

**â‘¢è¯¦ç»†è¯·æŸ¥é˜…[ä¸­é—´ä»¶->æºç ï¼Œè¯·ç‚¹å‡»](./src/temp.c)** ã€2023.11.24ã€‘TODO

**â‘£æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨å±•ç¤ºè¯»å–`COMå£`** ã€2023.11.27ã€‘TODO

> æ³¨: è¿™é‡Œæˆ‘å¹¶æ²¡æœ‰è¿ä»¥å¤ªç½‘ï¼Œè‹¥è¦è¿›è¡ŒMQTTè¿œç¨‹æ§åˆ¶å’Œæ˜¾ç¤ºï¼Œåªéœ€å°†æ­¤ç½‘å…³è¿æ¥ç½‘å…³å³å¯å®ç°ã€‚
>
> è¿™é‡Œçš„æ–‡ä»¶æ˜¯åœ¨`/homeç›®å½•`ä¸‹çš„ **a.out**  å¯æ‰§è¡Œæ–‡ä»¶

![æ¸©åº¦å±•ç¤º](./img/æ¸©åº¦å±•ç¤º.png)

**â‘¤æŒ¯åŠ¨ä¼ æ„Ÿå™¨éƒ¨åˆ†æ˜¾ç¤º** ã€2023.12.1ã€‘TODO

> æ³¨: è¿™é‡Œæœ‰è¿›è¡Œ `x, y, z` è½´çš„**FFTå˜æ¢** è®¡ç®—é¢‘è°±

![æŒ¯åŠ¨ä¼ æ„Ÿå™¨éƒ¨åˆ†](./img/æŒ¯åŠ¨ä¼ æ„Ÿå™¨.png)



**â‘¥æœ€ç»ˆç»“æœå±•ç¤º**

![video-to-gif](./img/video-to-gif.gif)

### â­â­å…¶ä»–çš„åç»­å†è¡¥å……ï¼Œæœ‰ç”¨çš„è¯è®°å¾—ç‚¹æ˜Ÿæ˜Ÿâ­~

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**`->AUTHOR: Brainy`** 

